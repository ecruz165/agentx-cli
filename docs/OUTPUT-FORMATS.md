# Output Formats Guide

AgentX CLI supports saving AI responses to files in multiple formats with rich metadata. This guide explains how to use the output format feature.

## Quick Start

```bash
# Save response as markdown (default)
agentx exec bff "Design an API schema" --file response.md

# Save as JSON
agentx exec bff "Design an API schema" --file response.json --output-format json

# Save as TOON (Token-Oriented Object Notation)
agentx exec bff "Design an API schema" --file response.toon --output-format toon

# Save as raw text (no metadata)
agentx exec bff "Design an API schema" --file response.txt --output-format raw
```

## Command Options

### `--file <path>`
Specifies the output file path. Can be:
- **Absolute path**: `/path/to/output.md`
- **Relative path**: `./outputs/response.md`
- **Filename only**: `response` (uses configured `outputLocation`)

If no extension is provided, the appropriate extension will be added based on the format.

### `--output-format <format>`
Specifies the output format. Options:
- `markdown` (default)
- `json`
- `toon`
- `raw`

## Format Details

### Markdown Format

**Extension**: `.md`

**Structure**:
```markdown
# AgentX AI Response

**Generated:** 2024-01-15T10:30:00.000Z
**Provider:** copilot
**Alias:** bff
**Version:** 1.0.0

## Prompt
[Your prompt here]

## Context Files
- `reference/bff/architecture.md`
- `patterns/bff-patterns/api-design.md`

## Response
[AI response content]

---
*Generated by AgentX CLI v1.0.0*
```

**Best for**: Documentation, human-readable output, integration with documentation systems

### JSON Format

**Extension**: `.json`

**Structure**:
```json
{
  "metadata": {
    "timestamp": "2024-01-15T10:30:00.000Z",
    "provider": "copilot",
    "alias": "bff",
    "version": "1.0.0"
  },
  "request": {
    "prompt": "Design an API schema",
    "contextFiles": [
      "reference/bff/architecture.md",
      "patterns/bff-patterns/api-design.md"
    ]
  },
  "response": {
    "content": "[AI response content]"
  }
}
```

**Best for**: Programmatic processing, APIs, data pipelines, automation

### TOON Format (Token-Oriented Object Notation)

**Extension**: `.toon`

**Structure**:
```
metadata:
  timestamp: 2024-01-15T10:30:00.000Z
  provider: copilot
  alias: bff
  version: 1.0.0
request:
  prompt: Design an API schema
  contextFiles:
    - reference/bff/architecture.md
    - patterns/bff-patterns/api-design.md
response:
  content: [AI response content]
```

**What is TOON?**
TOON (Token-Oriented Object Notation) is a compact, human-readable format designed specifically for Large Language Models (LLMs). It reduces token usage by approximately 30-60% compared to JSON while maintaining readability.

**Key Benefits**:
- **Token Efficient**: Uses fewer tokens than JSON, reducing API costs
- **LLM-Optimized**: Designed for AI consumption and generation
- **Human-Readable**: Clean, YAML-like syntax
- **Compact**: Minimal punctuation and whitespace

**Best for**: LLM workflows, AI pipelines, token-sensitive applications, cost optimization

### Raw Format

**Extension**: `.txt`

**Structure**:
```
[AI response content only - no metadata]
```

**Best for**: Simple text processing, piping to other commands, minimal overhead

## Configuration

You can set default output format and location in your configuration file:

```json
{
  "outputFormat": "markdown",
  "outputLocation": "./agentx-output"
}
```

### Configuration Options

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `outputFormat` | string | `markdown` | Default format for saved outputs |
| `outputLocation` | string | `./agentx-output` | Default directory for outputs |

### Setting via CLI

```bash
# Set default output format
agentx config set outputFormat json

# Set default output location
agentx config set outputLocation ~/my-ai-responses
```

## Examples

### Example 1: Save to Default Location

```bash
# Configure default location
agentx config set outputLocation ~/ai-responses

# Save with just filename (goes to ~/ai-responses/schema-design.md)
agentx exec bff "Design an API schema" --file schema-design
```

### Example 2: Organize by Date

```bash
# Create dated directory
DATE=$(date +%Y-%m-%d)
agentx exec bff "Design API" --file "./outputs/$DATE/api-design.md"
```

### Example 3: Multiple Formats

```bash
# Save same response in multiple formats
PROMPT="Design a user authentication system"

agentx exec api "$PROMPT" --file auth-design.md
agentx exec api "$PROMPT" --file auth-design.json --output-format json
agentx exec api "$PROMPT" --file auth-design.toon --output-format toon
```

### Example 4: Pipeline Processing

```bash
# Save as JSON and process with jq
agentx exec bff "List API endpoints" --file endpoints.json --output-format json
cat endpoints.json | jq '.response.content'
```

### Example 5: Quiet Mode with File Output

```bash
# Save to file without console output
agentx exec bff "Generate code" --file code.md --quiet
```

## Metadata Fields

All formats (except raw) include the following metadata:

| Field | Description | Example |
|-------|-------------|---------|
| `timestamp` | ISO 8601 timestamp | `2024-01-15T10:30:00.000Z` |
| `provider` | AI provider used | `copilot`, `claude`, `openai` |
| `alias` | Context alias used | `bff`, `rest-api` |
| `version` | AgentX CLI version | `1.0.0` |
| `prompt` | Original prompt | `Design an API schema` |
| `contextFiles` | List of context files | `["reference/bff/architecture.md"]` |
| `content` | AI response content | The actual response text |

## File Naming Best Practices

### Use Descriptive Names
```bash
# Good
agentx exec bff "Design schema" --file user-dashboard-schema.md

# Less descriptive
agentx exec bff "Design schema" --file output.md
```

### Include Context
```bash
# Include project/feature name
agentx exec api "Design endpoints" --file project-x-api-endpoints.md
```

### Use Timestamps for Iterations
```bash
# Append timestamp for multiple iterations
TIMESTAMP=$(date +%Y%m%d-%H%M%S)
agentx exec bff "Design schema" --file "schema-design-$TIMESTAMP.md"
```

### Organize by Category
```bash
# Use subdirectories
agentx exec bff "Design schema" --file schemas/user-dashboard.md
agentx exec api "Design endpoints" --file apis/user-service.md
agentx exec testing "Generate tests" --file tests/user-service-tests.md
```

## Integration Examples

### Git Workflow

```bash
# Save design decisions to docs
agentx exec bff "Design BFF architecture" --file docs/architecture/bff-design.md

# Commit with context
git add docs/architecture/bff-design.md
git commit -m "Add BFF architecture design from AI analysis"
```

### CI/CD Pipeline

```bash
#!/bin/bash
# Generate API documentation
agentx exec api "Document all endpoints" \
  --file api-docs.md \
  --output-format markdown

# Convert to HTML for deployment
pandoc api-docs.md -o api-docs.html
```

### Automation Script

```bash
#!/bin/bash
# Batch process multiple prompts

PROMPTS=(
  "Design user authentication"
  "Design data models"
  "Design API endpoints"
)

for prompt in "${PROMPTS[@]}"; do
  filename=$(echo "$prompt" | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
  agentx exec api "$prompt" --file "designs/$filename.md"
done
```

## Troubleshooting

### Permission Denied

```bash
# Error: Permission denied writing to /protected/path
# Solution: Use a writable directory
agentx exec bff "Design" --file ~/outputs/design.md
```

### Invalid Format

```bash
# Error: Invalid output format: 'xml'
# Solution: Use a valid format
agentx exec bff "Design" --file output.json --output-format json
```

### File Already Exists

AgentX will overwrite existing files. To prevent data loss:

```bash
# Use timestamps
agentx exec bff "Design" --file "design-$(date +%s).md"

# Or check before running
[ ! -f output.md ] && agentx exec bff "Design" --file output.md
```

## See Also

- [README.md](../README.md) - Main documentation
- [Configuration Guide](../README.md#configuration) - Configuration options
- [Commands Reference](../README.md#commands) - All available commands

